<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aiden’s Entertainment — Movies</title>

<!-- Preload background/logo for faster first paint -->
<link rel="preload" as="image" href="https://edef3.pcloud.com/DLZt042qEZnDxISB7ZWjPfZ7ZjJqaVkZNVZZnHXZZPUd7ZS0Ze0ZTpZJEop2M3fd58Vl0qNBzUo3Vf8n4n7/castlebg.jpeg?v=21">
<link rel="preload" as="image" href="https://edef11.pcloud.com/DLZh51BqEZ2pnOSB7ZWjPfZ7ZXFqaVkZ3VZZnHXZZsaN5ZwJZXJZJVZxoibDOlI51uhh5jphbiJgBhNz98X/aidensent.png?v=21">

<link rel="preconnect" href="https://edef3.pcloud.com" crossorigin>
<link rel="preconnect" href="https://edef11.pcloud.com" crossorigin>

<style>
  :root{
    --neon-core:#d6a4ff; --neon-mid:#a74fff; --neon-outer:#7b2cff;
    --card-w:3cm; --card-h:3cm; --header-z:1000;
  }
  html,body{height:100%;margin:0}
  body{background:#0b0a12;font-family:'Cinzel Decorative', serif;color:#fff;overflow-x:hidden}

  /* Background: show castle immediately behind the logo */
  .bg{
    position:fixed; inset:0; width:100%; height:100%;
    object-fit:cover; object-position:center top;  /* <— key line */
    z-index:-2; opacity:0; transition:opacity .35s ease
  }
  .bg.show{opacity:1}

  /* Lavender ambient glow sitting over the photo but behind content */
  .bg-glow{
    position:fixed; inset:0; z-index:-1; pointer-events:none;
    background:
      radial-gradient(60% 30% at 50% 10%, rgba(167,79,255,.55), rgba(167,79,255,.12) 40%, transparent 70%),
      radial-gradient(45% 20% at 50% 8%, rgba(214,164,255,.45), transparent 60%);
    animation: glowPulse 4.2s ease-in-out infinite, glowFlicker 7s linear infinite;
    mix-blend-mode: screen
  }
  @keyframes glowPulse{0%,100%{opacity:.55;filter:blur(0)}50%{opacity:.95;filter:blur(1px)}}
  @keyframes glowFlicker{0%,19%,21%,23%,25%,54%,56%,100%{filter:brightness(1)}20%,24%,55%{filter:brightness(1.15)}}

  /* Header: logo at the VERY top, menu right under it */
  header{position:sticky; top:0; z-index:var(--header-z); display:flex; flex-direction:column; align-items:center; backdrop-filter:blur(1.5px)}
  .logo-wrap{display:flex; justify-content:center; align-items:center; width:100%; padding-top:6px; padding-bottom:4px}
  .logo{
    display:block; width:min(520px,92vw); margin:0 auto; animation:logoPulse 3s infinite;
    filter:drop-shadow(0 0 6px var(--neon-core)) drop-shadow(0 0 12px var(--neon-mid)) drop-shadow(0 0 24px var(--neon-outer))
  }
  @keyframes logoPulse{
    0%,100%{filter:drop-shadow(0 0 6px var(--neon-core)) drop-shadow(0 0 12px var(--neon-mid)) drop-shadow(0 0 24px var(--neon-outer))}
    50%{filter:drop-shadow(0 0 12px var(--neon-core)) drop-shadow(0 0 24px var(--neon-mid)) drop-shadow(0 0 48px var(--neon-outer))}
  }

  .nav-bar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;padding:8px 10px}
  .btn-neon{
    padding:10px 16px; font-size:1rem; font-weight:800; text-transform:uppercase; letter-spacing:.4px;
    background:#111; color:var(--neon-core);
    border:2px solid var(--neon-core); border-radius:12px; cursor:pointer;
    box-shadow:0 0 10px var(--neon-outer), inset 0 0 10px rgba(167,79,255,.25); text-decoration:none
  }
  .btn-neon:hover{background:var(--neon-core); color:#000}
  .btn-tab.active{background:var(--neon-core); color:#000}

  .chips{display:flex; flex-wrap:wrap; gap:6px; justify-content:center; margin:0 0 10px}
  .chip{
    padding:5px 10px; border:1px solid var(--neon-mid); border-radius:999px; cursor:pointer;
    color:#e9ddff; background:rgba(16,12,28,.55);
    box-shadow:inset 0 0 12px rgba(167,79,255,.25), 0 0 12px rgba(123,44,255,.18);
    font-size:.88rem; user-select:none
  }
  .chip.active{border-color:#fff; color:#fff; box-shadow:0 0 16px rgba(184,108,255,.55), inset 0 0 14px rgba(184,108,255,.25)}
  .chip .count{opacity:.8; font-size:.8em}

  main{padding:8px 10px 48px}
  #grid{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;margin:0}

  .card{display:inline-block;text-align:center;max-width:calc(var(--card-w) + 2rem)}
  .window{
    position:relative; width:var(--card-w); height:var(--card-h);
    border-radius:12px; overflow:hidden; display:block;
    filter:drop-shadow(0 0 6px var(--neon-core)) drop-shadow(0 0 12px var(--neon-mid)) drop-shadow(0 0 24px var(--neon-outer))
  }
  .window img{width:100%; height:100%; object-fit:cover; border-radius:12px; display:block}
  .placeholder{
    width:100%; height:100%; display:grid; place-items:center; background:rgba(8,8,12,.55);
    color:#cdbbff; font-weight:700; text-shadow:0 0 8px rgba(167,79,255,.4); border-radius:12px
  }
  .window::after{
    content:""; position:absolute; inset:0; border-radius:12px; pointer-events:none; border:3px solid var(--neon-core);
    box-shadow:0 0 6px 2px #c27fff, 0 0 12px 4px var(--neon-mid), 0 0 24px 6px var(--neon-outer), 0 0 48px 10px rgba(123,44,255,.6);
    animation:frameFlicker 3s infinite
  }
  @keyframes frameFlicker{0%,19%,21%,23%,25%,54%,56%,100%{opacity:1}20%,24%,55%{opacity:.78}}

  .row-head{display:flex;align-items:center;gap:8px;justify-content:center;margin-top:4px}
  .title{font-size:.9rem;color:#e6dcff;text-shadow:0 0 8px rgba(167,79,255,.45)}
  .title a{color:#e6dcff;text-decoration:none}
  .title a:hover{text-decoration:underline}

  .menu{position:relative;display:inline-block}
  .more-btn{
    padding:2px 8px;line-height:1.2;border-radius:10px;cursor:pointer;
    border:1px solid var(--neon-core);background:rgba(18,14,28,.7);color:var(--neon-core);
    box-shadow:0 0 6px rgba(123,44,255,.35), inset 0 0 6px rgba(123,44,255,.2);font-weight:800
  }
  .more-btn:hover{background:var(--neon-core);color:#000}
  .menu-panel{
    position:absolute;left:50%;transform:translateX(-50%);margin-top:6px;min-width:180px;z-index:5;background:#100e1a;
    border:1px solid var(--neon-mid);border-radius:12px;
    box-shadow:0 0 18px rgba(184,108,255,.35), inset 0 0 12px rgba(184,108,255,.18);
    padding:6px;display:none
  }
  .menu.open .menu-panel{display:block}
  .menu-item{display:block;width:100%;text-align:left;padding:8px 10px;margin:2px 0;background:transparent;border:1px solid rgba(184,108,255,.35);border-radius:10px;color:#eedeff;cursor:pointer}
  .menu-item:hover{background:var(--neon-core);color:#000;border-color:var(--neon-core)}

  .chosen{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-top:6px}
  .chosen .cat{
    padding:3px 8px;border:1px solid rgba(184,108,255,.65);border-radius:999px;font-size:.72rem;color:#f0e8ff;background:rgba(24,18,38,.55);
    box-shadow:inset 0 0 8px rgba(167,79,255,.22), 0 0 8px rgba(123,44,255,.16)
  }

  /* Modal for category checkboxes */
  .modal{position:fixed;inset:0;background:rgba(8,6,14,.55);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:2000}
  .modal.open{display:flex}
  .panel{background:#0e0c18;border:1px solid var(--neon-mid);border-radius:14px;box-shadow:0 0 24px rgba(184,108,255,.35);padding:14px 16px;width:min(520px,92vw)}
  .grid-cb{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px;margin:10px 0}
  .opt{display:flex;align-items:center;gap:8px}
  .modal-actions{display:flex;justify-content:flex-end;gap:10px}
</style>
</head>
<body data-section="movies">

  <!-- Background image (remote), shows behind the logo -->
  <img id="bg" class="bg" fetchpriority="high" decoding="async"
       src="https://edef3.pcloud.com/DLZt042qEZnDxISB7ZWjPfZ7ZjJqaVkZNVZZnHXZZPUd7ZS0Ze0ZTpZJEop2M3fd58Vl0qNBzUo3Vf8n4n7/castlebg.jpeg?v=21" alt="" />
  <div class="bg-glow" aria-hidden="true"></div>

  <header>
    <div class="logo-wrap">
      <img id="logo" class="logo" fetchpriority="high" decoding="async"
           src="https://edef11.pcloud.com/DLZh51BqEZ2pnOSB7ZWjPfZ7ZXFqaVkZ3VZZnHXZZsaN5ZwJZXJZJVZxoibDOlI51uhh5jphbiJgBhNz98X/aidensent.png?v=21"
           alt="AIDEN’S ENTERTAINMENT" />
    </div>

    <nav class="nav-bar">
      <a id="tabMovies" class="btn-neon btn-tab">Movies</a>
      <a id="tabTV" class="btn-neon btn-tab">TV Shows</a>
      <a id="tabPorn" class="btn-neon btn-tab">Porn</a>
      <button id="addBtn" class="btn-neon">Add Movie</button>
    </nav>

    <div id="chips" class="chips"></div>
  </header>

  <main>
    <div id="grid"></div>
  </main>

  <!-- Categories picker -->
  <div id="catModal" class="modal" aria-hidden="true">
    <div class="panel">
      <h3>Select categories</h3>
      <div id="cbGrid" class="grid-cb"></div>
      <div class="modal-actions">
        <button id="cancelPick" class="btn-neon" type="button">Cancel</button>
        <button id="confirmPick" class="btn-neon" type="button">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Your pasted list lives here. Parsed on first load and saved. -->
  <script id="seed-raw" type="text/plain">
<!-- PASTE BLOCK START -->
28 days later- https://dobby.site/movies/28-days-later-dot-dot-dot-2002?_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
thumbnail: https://edef10.pcloud.com/DLZ8ofLtEZO8STuB7ZWjPfZ7ZEPF3VkZNVZZnHXZZ7vkZW4ZL8Z7QZuM5Jl6HpFQ7GLL1oVDQIvSgbASH7/28days.jpg

28 weeks later- https://dobby.site/movies/28-weeks-later-2007?_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
thumbnail: https://edef9.pcloud.com/DLZ4d3hUEZf04gnB7ZWjPfZ7ZtxF3VkZNVZZnHXZZAgRZIHZmkZ50ZSB8SqHieakfjmrJBoUO9uHE2ODOy/28weeks.jpg

30 days of night- https://dobby.site/movies/30-days-of-night-2007?pl=-1&_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
thumbnail: https://edef4.pcloud.com/DLZAl3hUEZ6V4gnB7ZWjPfZ7ZzwF3VkZNVZZnHXZZ1PgZRzZtJZDHZ9zNE2RdJhbYhPCaUePALeL5pLGUy/30days.jpg

Addams Family: https://dobby.site/movies/the-addams-family-1991?pl=-1&_u=hchh6mwu5k&_t=33dp8k&_rsrc=chrome/newtab
Thumbnail: https://edef10.pcloud.com/DLZyq3hUEZup4gnB7ZWjPfZ7ZPoF3VkZNVZZnHXZZmlsZwHZK4Z25Z5Nh4IsQk7CuAdLw9R62bzjyIrHLk/addams.jpg

Addams Family values: https://dobby.site/movies/addams-family-values-1993?_rsrc=chrome/newtab&_t=33dp8k&_u=hchh6mwu5k&pl=-1
Thumbnail: https://edef7.pcloud.com/DLZGO3hUEZQh4gnB7ZWjPfZ7ZYyp3VkZNVZZnHXZZIPh7Z1RZPpZ1XZF94gu8JfLS7FtC17Bkie54GHYoKk/addams2.jpg

A simple favour: https://dobby.site/movies/a-simple-favor-2018?_rsrc=chrome/newtab&_t=7gl997&_u=hchh6mwu5k&pl=-1
Thumbnail: https://edef5.pcloud.com/DLZol3hUEZiV4gnB7ZWjPfZ7ZF7p3VkZNVZZnHXZZG85Z1FZ9XZiLZiSaI2OvWbG0YnuSbturu0FSxG8Ey/simplefavour.jpg

Artificial Intelligence: https://dobby.site/movies/ai-artificial-intelligence-2001?pl=-1&_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
Thumbnail: https://edef6.pcloud.com/DLZ5t3hUEZlJ4gnB7ZWjPfZ7Zlyp3VkZNVZZnHXZZfq27Z55ZkkZNRZcdpXzu4TWdhJ9ijXGwsFERAvncSX/ai.jpg

Alien- https://dobby.site/movies/alien-1979?pl=-1&_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
Thumbnail: https://edef9.pcloud.com/DLZl63hUEZ444gnB7ZWjPfZ7Z97p3VkZNVZZnHXZZtgwZxHZuHZRpZNEpKfieYG9HYNKcj8Nm2cXbcdjwk/alien.jpg

Alien Romulus- https://dobby.site/movies/alien-romulus-2024?pl=-1&_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
Thumbnail: https://edef6.pcloud.com/DLZ0I3hUEZcS4gnB7ZWjPfZ7ZfXp3VkZNVZZnHXZZKDB7ZQFZCHZeHZ5sBYcqD7kt4kOO7k4uh8rk0d6BV7/romulus.jpg

Aliens- https://dobby.site/movies/aliens-1986?pl=-1&_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
Thumbnail: https://edef4.pcloud.com/DLZ9N3hUEZa24gnB7ZWjPfZ7Zkkp3VkZNVZZnHXZZhcFVZY0Zy5ZdFZyNwGKXOMRQ4aR3JkUXan0XzPisaX/aliens.jpg

Alien 3 - https://dobby.site/movies/alien3-1992?pl=-1&_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
Thumbnail: https://edef3.pcloud.com/DLZjO3hUEZuQ4gnB7ZWjPfZ7ZN7p3VkZNVZZnHXZZ5vMZfzZDFZ8RZFhwPmQRVys4BlXAuViSBhRk8dtek/alien3.jpg

Alien 4- https://dobby.site/movies/alien-resurrection-1997?pl=-1&_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
Thumbnail: https://edef3.pcloud.com/DLZuE3hUEZiR4gnB7ZWjPfZ7ZGkp3VkZNVZZnHXZZHHFZMLZHLZ3XZkM0QMSdR2hzfYc2us8Ycr4Iz1N2V/alien4.jpg

Angels in America: https://dobby.site/shows/angels-in-america?_u=hchh6mwu5k&_t=e14tdp&_rsrc=chrome/newtab
Thumbnail: https://edef1.pcloud.com/DLZcA3hUEZoB4gnB7ZWjPfZ7ZFVp3VkZNVZZnHXZZ8s67ZEJZhHZXHZmzVn3YCBUymIAVCbazbG7FKhIOOV/angels.jpg

Batman- https://dobby.site/movies/batman-1989?pl=-1&_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
Thumbnail: https://edef12.pcloud.com/DLZbI3hUEZRj4gnB7ZWjPfZ7Zq0p3VkZNVZZnHXZZQJYZzzZLzZpFZHt4MrrsB8gj5l8Y2z0DIe5MYTrFX/batman.jpg

Batman returns- https://dobby.site/movies/batman-returns-1992?pl=-1&_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
Thumbnail: https://edef3.pcloud.com/DLZ6a3hUEZ6s4gnB7ZWjPfZ7ZR5p3VkZNVZZnHXZZoNk7ZgJZDHZn5Zz6jijvALWjmv6s7U4tw6yfSWq9rX/batman2.jpg

Batman Forever - https://dobby.site/movies/batman-returns-1992?pl=-1&_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
Thumbnail: https://edef4.pcloud.com/DLZlN3hUEZuW4gnB7ZWjPfZ7Zq5p3VkZNVZZnHXZZc4aZ6FZ45ZDLZFCx0vO2830unIOxIqI3Y4mwhx7xV/batmanforever.jpg

The Batman - https://dobby.site/movies/the-batman-2022?pl=-1&_u=hchh6mwu5k&_t=bq0t40&_rsrc=chrome/newtab
Thumbnail: https://edef1.pcloud.com/DLZXN3hUEZGB4gnB7ZWjPfZ7ZRJp3VkZNVZZnHXZZTbzZeLZhJZr0ZasMfyfU0Iszwt8P86PICjhnXgETk/thebatman.jpg

Barb and Star: https://dobby.site/movies/barb-and-star-go-to-vista-del-mar-2021?_rsrc=chrome/newtab&_t=gcqrcb&_u=hchh6mwu5k&pl=-1
Thumbnail: https://edef7.pcloud.com/DLZja3hUEZGs4gnB7ZWjPfZ7ZmVp3VkZNVZZnHXZZTy4ZkHZbFZJRZOUoK1gAYg3zuiga6E9HaPbcD8UoV/barb.jpg

Becky: https://dobby.site/movies/becky-2020?_rsrc=chrome/newtab&_t=h5aqtn&_u=hchh6mwu5k&pl=-1
Thumbnail: https://edef3.pcloud.com/DLZK33hUEZ7e4gnB7ZWjPfZ7ZCJp3VkZNVZZnHXZZFMbZfJZCFZ3XZTCFH4OqTEe0mykQEBAPiqQC1OjNX/becky.jpg

The wrath of Becky: https://dobby.site/movies/the-wrath-of-becky-2023?pl=-1&_u=hchh6mwu5k&_t=h5aqtn&_rsrc=chrome/newtab
Thumbnail: https://edef11.pcloud.com/DLZQi3hUEZ4g4gnB7ZWjPfZ7ZrJp3VkZNVZZnHXZZKqMZapZo5ZqLZSkLMrWKXRfFAThY4OHFfpXEVobak/becky2.jpg

<!-- … (your full list continues exactly as you pasted) … -->
<!-- PASTE BLOCK END -->
  </script>

<script>
  /* ---------- CONFIG ---------- */
  const CATS = ['horror','thriller','fantasy','sci-fi','comedy','cartoon','porn','other'];
  const STORAGE_KEYS = { movies:'castle.movies.v22', tv:'castle.tv.v22', porn:'castle.porn.v22' };

  /* ---------- Parse your raw list (Title - URL, optional "Thumbnail: URL") ---------- */
  function parseRawList(raw){
    const blocks = raw.split(/\n\s*\n/).map(b=>b.trim()).filter(Boolean);
    const items = [];
    const firstLineRe = /^(.+?)\s*[-:]\s*(https?:\/\/\S+)/i;
    const thumbLineRe = /^thumbnail\s*:\s*(https?:\/\/\S+)?/i;
    for(const b of blocks){
      const lines = b.split(/\n/).map(s=>s.trim()).filter(Boolean);
      if(!lines.length) continue;
      const m = lines[0].match(firstLineRe);
      if(!m) continue;
      const title = m[1].trim();
      const link  = m[2].trim();
      let img = null;
      for(let i=1;i<lines.length;i++){
        const t = lines[i];
        const mt = t.match(thumbLineRe);
        if(mt){
          img = mt[1] ? mt[1].trim() : null;
          if(!img && lines[i+1] && /^https?:\/\//i.test(lines[i+1])) img = lines[i+1].trim();
          break;
        }
      }
      items.push({title, link, img, categories:[]});
    }
    return items;
  }

  /* ---------- Storage ---------- */
  let section = document.body.dataset.section || 'movies';
  let currentFilter = 'All';
  const load = () => { try { return JSON.parse(localStorage.getItem(STORAGE_KEYS[section])) || []; } catch { return []; } };
  const save = (items) => localStorage.setItem(STORAGE_KEYS[section], JSON.stringify(items));

  function preloadOnceFromRaw(){
    if(section!=='movies') return;
    const key = STORAGE_KEYS.movies;
    if(localStorage.getItem(key)) return;
    const rawTag = document.getElementById('seed-raw');
    if(!rawTag) return;
    const items = parseRawList(rawTag.textContent || rawTag.innerText || '');
    if(items.length){ localStorage.setItem(key, JSON.stringify(items)); }
  }

  /* ---------- UI helpers ---------- */
  function setActiveTab(){
    document.querySelectorAll('.btn-tab').forEach(b=>b.classList.remove('active'));
    const el = document.querySelector({movies:'#tabMovies', tv:'#tabTV', porn:'#tabPorn'}[section]);
    if(el) el.classList.add('active');
    const addBtn = document.getElementById('addBtn');
    if(addBtn) addBtn.textContent = section==='tv'?'Add Show':(section==='movies'?'Add Movie':'Add Link');
  }

  function renderChips(items){
    const wrap=document.getElementById('chips'); wrap.innerHTML='';
    const countFor=(c)=>items.filter(i=>(i.categories||[]).includes(c)).length;
    ['All',...CATS].forEach(c=>{
      const chip=document.createElement('div'); chip.className='chip'+(c===currentFilter?' active':'');
      const count=c==='All'?items.length:countFor(c);
      chip.innerHTML=`<span>${c}</span> <span class="count">(${count})</span>`;
      chip.onclick=()=>{currentFilter=c; render()};
      wrap.appendChild(chip);
    });
  }

  function openPicker(preset=[]){
    return new Promise(res=>{
      const modal=document.getElementById('catModal'), grid=document.getElementById('cbGrid');
      grid.innerHTML='';
      CATS.forEach(c=>{
        const row=document.createElement('label'); row.className='opt';
        row.innerHTML=`<input type="checkbox" value="${c}" ${preset.includes(c)?'checked':''}><span>${c}</span>`;
        grid.appendChild(row);
      });
      const ok=document.getElementById('confirmPick'), cancel=document.getElementById('cancelPick');
      const onOK=()=>{const picked=[...grid.querySelectorAll('input:checked')].map(i=>i.value); cleanup(); res(picked)};
      const onCancel=()=>{cleanup(); res(null)};
      function cleanup(){ok.removeEventListener('click',onOK);cancel.removeEventListener('click',onCancel);modal.classList.remove('open');modal.setAttribute('aria-hidden','true')}
      ok.addEventListener('click',onOK); cancel.addEventListener('click',onCancel);
      modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
    });
  }

  /* Create a thumbnail <img> with anti-hotlink fallback */
  function buildThumb(src){
    const img = document.createElement('img');
    img.loading = 'lazy';
    img.decoding = 'async';
    img.referrerPolicy = 'no-referrer';
    let triedProxy = false;
    img.onerror = () => {
      if(!triedProxy && src){
        triedProxy = true;
        img.src = 'https://images.weserv.nl/?url=' + encodeURIComponent(src);
      }else{
        img.replaceWith(Object.assign(document.createElement('div'), {className:'placeholder', textContent:'No Thumbnail'}));
      }
    };
    img.src = src || '';
    if(!src) img.onerror(); // trigger placeholder immediately when no src
    return img;
  }

  function makeMenu(onEditLink,onChangeCover,onEditCats,onDelete){
    const wrap=document.createElement('div'); wrap.className='menu';
    const btn=document.createElement('button'); btn.className='more-btn'; btn.textContent='…';
    const panel=document.createElement('div'); panel.className='menu-panel';
    const mk=(t,h)=>{const b=document.createElement('button'); b.className='menu-item'; b.textContent=t; b.onclick=(e)=>{e.preventDefault();e.stopPropagation();h();wrap.classList.remove('open')};return b};
    panel.appendChild(mk('Edit Link',onEditLink));
    panel.appendChild(mk('Change Cover',onChangeCover));
    panel.appendChild(mk('Edit Categories',onEditCats));
    panel.appendChild(mk('Delete',onDelete));
    btn.onclick=(e)=>{e.preventDefault();e.stopPropagation();wrap.classList.toggle('open')};
    document.addEventListener('click',(ev)=>{if(!wrap.contains(ev.target)) wrap.classList.remove('open')});
    wrap.appendChild(btn); wrap.appendChild(panel); return wrap;
  }

  function card(item,idx,items){
    const c=document.createElement('div'); c.className='card';
    const a=document.createElement('a'); a.className='window'; a.href=item.link||'#'; a.target='_blank'; a.rel='noopener';
    if(item.img){ a.appendChild(buildThumb(item.img)); } else { a.innerHTML='<div class="placeholder">No Thumbnail</div>'; }
    c.appendChild(a);

    const head=document.createElement('div'); head.className='row-head';
    const t=document.createElement('div'); t.className='title';
    t.innerHTML=`<a href="${item.link||'#'}" target="_blank" rel="noopener">${item.title||'Untitled'}</a>`;
    head.appendChild(t);
    const menu=makeMenu(
      ()=>{const u=prompt('Enter the link (URL):',item.link||''); if(u===null) return; const d=load(); d[idx].link=(u.trim()||'#'); save(d); render();},
      ()=>{const u=prompt('Thumbnail image URL (leave blank to remove):',item.img||''); if(u===null) return; const d=load(); d[idx].img=(u.trim()||null); save(d); render();},
      async()=>{const picked=await openPicker(item.categories||[]); if(picked===null) return; const d=load(); d[idx].categories=[...new Set(picked)]; save(d); render();},
      ()=>{if(confirm('Delete this item?')){const d=load(); d.splice(idx,1); save(d); render();}}
    );
    head.appendChild(menu); c.appendChild(head);

    const chosen=document.createElement('div'); chosen.className='chosen';
    (item.categories||[]).forEach(cat=>{const s=document.createElement('span'); s.className='cat'; s.textContent=cat; chosen.appendChild(s)});
    c.appendChild(chosen);
    return c;
  }

  function render(){
    setActiveTab();
    const items=load(); renderChips(items);
    const grid=document.getElementById('grid'); grid.innerHTML='';
    const vis=(currentFilter==='All')?items:items.filter(x=>(x.categories||[]).includes(currentFilter));
    vis.forEach(it=>grid.appendChild(card(it, items.indexOf(it), items)));
  }

  async function addItem(){
    const link=prompt(`Enter the ${section==='tv'?'show':'link'} (URL):`)||'#';
    const title=prompt(`Enter a title for this ${section==='tv'?'show':'link'}:`)||'Untitled';
    const categories=await openPicker([]); if(categories===null) return;
    const img=prompt('Thumbnail image URL (optional):')||null;
    const items=load(); items.push({link,title,img,categories:[...new Set(categories)]});
    save(items); currentFilter='All'; render();
  }

  function setSection(s){ section=s; currentFilter='All'; render(); }

  function setupImages(){
    const bg=document.getElementById('bg');
    if(bg.complete) bg.classList.add('show'); else bg.addEventListener('load',()=>bg.classList.add('show'));
    // Optional local assets fallback if you later host /assets
    const testBg=new Image(); testBg.onload=()=>{ bg.src='assets/castlebg.jpeg?v=21' }; testBg.src='assets/castlebg.jpeg?v=21';
    const logo=document.getElementById('logo'); const testLogo=new Image(); testLogo.onload=()=>{ logo.src='assets/logo.png?v=21' }; testLogo.src='assets/logo.png?v=21';
  }

  window.addEventListener('DOMContentLoaded', ()=>{
    preloadOnceFromRaw();
    setupImages();
    document.getElementById('tabMovies')?.addEventListener('click', ()=>setSection('movies'));
    document.getElementById('tabTV')?.addEventListener('click', ()=>setSection('tv'));
    document.getElementById('tabPorn')?.addEventListener('click', ()=>setSection('porn'));
    document.getElementById('addBtn')?.addEventListener('click', addItem);
    render();
  });
</script>
</body>
</html>
